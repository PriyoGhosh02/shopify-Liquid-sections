{{ 'section-newsletter.css' | asset_url | stylesheet_tag }}

{%- style -%}
  #shopify-section-{{ section.id }} {
    --section-bg-color: {{ section.settings.background_color }};
    --section-text-color: {{ section.settings.text_color }};
    --form-bg-color: {{ section.settings.form_background_color }};
    --radio-color: {{ section.settings.radio_color }};
    --button-bg-color: {{ section.settings.button_background_color }};
    --button-text-color: {{ section.settings.button_text_color }};
    
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: var(--section-bg-color);
  }

  @media (min-width: 768px) {
    #shopify-section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top | times: 1.5 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 1.5 }}px;
    }
  }

  @media (min-width: 1024px) {
    #shopify-section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top | times: 2 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 2 }}px;
    }
  }
{%- endstyle -%}

<section class="newsletter-section newsletter-section--{{ section.id }}" id="newsletter-section-{{ section.id }}">
  <div class="newsletter-container">
    <div class="newsletter-grid">
      <!-- Form Side -->
      <div class="newsletter-form-container" style="background-color: var(--form-bg-color);">
        <div class="newsletter-form-wrapper">

          {% if section.settings.subtitle != blank %}
            <div class="newsletter-subtitle">{{ section.settings.subtitle }}</div>
          {% endif %}
          
          {% if section.settings.title != blank %}
            <h2 class="newsletter-title">{{ section.settings.title }}</h2>
          {% endif %}
          
          {% if section.settings.question != blank %}
            <h3 class="newsletter-question">{{ section.settings.question }}</h3>
          {% endif %}

          <!-- SHOPIFY CUSTOMER FORM -->
          <newsletter-form>
            {% form 'customer', id: 'newsletter-form-{{ section.id }}', class: 'newsletter-form' %}
              <!-- Hidden tags: 'newsletter' + selected radio -->
              <input type="hidden" name="contact[tags]" id="contact-tags-{{ section.id }}" value="newsletter">

              <!-- Radio Options -->
              <div class="radio-group">
                <fieldset>
                  <legend class="visually-hidden">{{ section.settings.question }}</legend>
                  {% for block in section.blocks %}
                    {% if block.type == 'radio_option' %}
                      <div class="radio-option">
              <input
                type="radio"
                id="option-{{ block.id }}"
                name="skin_priority"
                value="{{ block.settings.option_label }}"
                {% if forloop.first %}checked{% endif %}
                required
              >

                        <label for="option-{{ block.id }}">
                          <span class="radio-custom"></span>
                          <span class="radio-label">{{ block.settings.option_label }}</span>
                        </label>
                      </div>
                    {% endif %}
                  {% endfor %}
                </fieldset>
              </div>
              
              <!-- Email + Submit -->
              <div class="form-row">
                <div class="email-field">
                  <input 
                    type="email" 
                    name="contact[email]" 
                    id="email-{{ section.id }}" 
                    class="field__input"
                    placeholder="{{ section.settings.email_placeholder }}" 
                    required 
                    autocomplete="email"
                    autocorrect="off"
                    autocapitalize="off"
                  />
                  <div class="form-error" id="email-error-{{ section.id }}"></div>
                </div>
                <button 
                  type="submit" 
                  class="submit-button"
                  style="background-color: var(--button-bg-color); color: var(--button-text-color);"
                >
                  {{ section.settings.button_text }}
                </button>
              </div>
              
              {% if section.settings.privacy_text != blank %}
                <div class="privacy-text">{{ section.settings.privacy_text }}</div>
              {% endif %}

              <!-- Simple success / error placeholders (Shopify can override on redirect) -->
              <div class="form-message success-message" id="success-message-{{ section.id }}" style="display:none;">
                {{ section.settings.success_message }}
              </div>
              <div class="form-message error-message" id="error-message-{{ section.id }}" style="display:none;">
                <span id="error-text-{{ section.id }}"></span>
              </div>

            {% endform %}
          </newsletter-form>
        </div>
      </div>
      
      <!-- Image Side (unchanged) -->
      <div class="newsletter-image-container">
        {% if section.settings.image != blank %}
          <div class="image-wrapper">
            {% if section.settings.mobile_image != blank %}
              <img
                src="{{ section.settings.mobile_image | img_url: '800x' }}"
                srcset="{{ section.settings.mobile_image | img_url: '352x' }} 352w, {{ section.settings.mobile_image | img_url: '800x' }} 800w"
                sizes="(max-width: 1023px) 100vw, 0px"
                width="800"
                height="800"
                loading="lazy"
                class="newsletter-image mobile-image"
                alt="{{ section.settings.mobile_image.alt | escape }}"
                style="object-position: {{ section.settings.mobile_image_position }};"
              />
            {% endif %}
            
            <img
              src="{{ section.settings.image | img_url: '1200x' }}"
              srcset="{{ section.settings.image | img_url: '352x' }} 352w, {{ section.settings.image | img_url: '832x' }} 832w, {{ section.settings.image | img_url: '1200x' }} 1200w"
              sizes="(min-width: 1024px) 50vw, 0px"
              width="1200"
              height="1200"
              loading="lazy"
              class="newsletter-image desktop-image"
              alt="{{ section.settings.image.alt | escape }}"
              style="object-position: {{ section.settings.image_position }};"
            />
          </div>
        {% else %}
          <div class="placeholder-image">
            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var form = document.getElementById('newsletter-form-{{ section.id }}');
  if (!form) return;

  var tagInput = document.getElementById('contact-tags-{{ section.id }}');
  var radios = form.querySelectorAll('input[name="skin_priority"]');

  function normalize(value) {
    return value
      .toLowerCase()
      .trim()
      .replace(/\s+/g, '_')
      .replace(/,/g, '');
  }

  radios.forEach(function (radio) {
    radio.addEventListener('change', function () {
      tagInput.value = 'newsletter,' + normalize(this.value);
    });
  });

  // Set initial value (first checked radio)
  var checked = form.querySelector('input[name="skin_priority"]:checked');
  if (checked) {
    tagInput.value = 'newsletter,' + normalize(checked.value);
  }
});
</script>





<style>

#shopify-section-template--27253621457242__p_image_testmonial_WhtqFn{
padding:40px 0;
}

.newsletter-section {
  color: var(--section-text-color);
}

.newsletter-container {
  max-width: 1600px;
  margin: 0 auto;
  padding: 0 20px;
}

.newsletter-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
}

@media (min-width: 1024px) {
  .newsletter-grid {
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: stretch;
  }
}

/* Form Container */
.newsletter-form-container {
  border-radius: 20px;
  padding: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

@media (min-width: 768px) {
  .newsletter-form-container {
    padding: 60px;
  }
}

.newsletter-form-wrapper {
  width: 100%;
  max-width: 500px;
}

.newsletter-subtitle {
  font-size: 14px;
  font-weight: 400;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.newsletter-title {
  font-size: 36px;
  font-weight: 400;
  line-height: 1.2;
  margin-bottom: 20px;
}

@media (min-width: 768px) {
  .newsletter-title {
    font-size: 44px;
  }
}

.newsletter-question {
  font-size: 20px;
  font-weight: 400;
  margin-bottom: 20px;
}

/* Radio Options */
.radio-group {
  margin-bottom: 30px;
}

.radio-option {
  margin-bottom: 10px;
}

.radio-option input[type="radio"] {
  display: none;
}

.radio-option label {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 8px 0;
  font-size: 16px;
}

.radio-custom {
  width: 20px;
  height: 20px;
  border: 2px solid var(--radio-color);
  border-radius: 50%;
  margin-right: 12px;
  position: relative;
  flex-shrink: 0;
}

/* THIS makes the custom circle fill when the radio is selected */
.radio-option input[type="radio"]:checked + label .radio-custom::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 10px;
  height: 10px;
  background-color: var(--radio-color);
  border-radius: 50%;
}

.radio-label {
  line-height: 1.4;
}

/* Form Row */
.form-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 15px;
  margin-bottom: 20px;
}

.email-field {
  position: relative;
}

.email-field input {
  width: 100%;
  height: 48px;
  padding: 0 16px;
  border: 1px solid var(--radio-color);
  background-color: transparent;
  color: var(--section-text-color);
  font-size: 16px;
  border-radius: 0;
}

.email-field input:focus {
  outline: none;
  border-width: 2px;
}

.form-error {
  color: #d32f2f;
  font-size: 12px;
  margin-top: 4px;
  min-height: 16px;
}

.submit-button {
  height: 48px;
  padding: 0 30px;
  border: none;
  border-radius: 24px;
  font-size: 14px;
  font-weight: 400;
  cursor: pointer;
  white-space: nowrap;
  transition: opacity 0.2s ease;
}

.submit-button:hover {
  opacity: 0.9;
}

.submit-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.privacy-text {
  font-size: 12px;
  line-height: 1.5;
  opacity: 0.8;
  margin-top: 15px;
}

/* Form Messages */
.form-message {
  padding: 15px;
  border-radius: 4px;
  margin-top: 20px;
}

.success-message {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.error-message {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

/* Image Container */
.newsletter-image-container {
  order: -1;
}

@media (min-width: 1024px) {
  .newsletter-image-container {
    order: 1;
  }
}

.image-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 300px;
  border-radius: 20px;
  overflow: hidden;
}

@media (min-width: 768px) {
  .image-wrapper {
    min-height: 500px;
  }
}

@media (min-width: 1024px) {
  .image-wrapper {
    min-height: 600px;
  }
}

.newsletter-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
}

.mobile-image {
  display: block;
}

.desktop-image {
  display: none;
}

@media (min-width: 1024px) {
  .mobile-image {
    display: none;
  }
  
  .desktop-image {
    display: block;
  }
}

.placeholder-image {
  width: 100%;
  height: 100%;
  background-color: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  border-radius: 20px;
}

.placeholder-svg {
  width: 100%;
  height: 100%;
  fill: #e0e0e0;
}

.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
</style>

{% schema %}
{
  "name": "Newsletter with Image",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Discovered by NASA."
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Get Access to Exclusive BFCM Offers."
    },
    {
      "type": "text",
      "id": "question",
      "label": "Question",
      "default": "What's your skin's priority?"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "Enter your email"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "SIGN UP"
    },
    {
      "type": "richtext",
      "id": "privacy_text",
      "label": "Privacy text",
      "default": "<p>Learn how we collect and use your data, or contact us with privacy questions and rights requests.</p>"
    },
    {
      "type": "richtext",
      "id": "success_message",
      "label": "Success message",
      "default": "<p>Thank you for subscribing! Check your email for exclusive offers.</p>"
    },
    {
      "type": "header",
      "content": "Images"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Desktop Image"
    },
    {
      "type": "image_picker",
      "id": "mobile_image",
      "label": "Mobile Image (Optional)",
      "info": "If not set, desktop image will be used on all screens"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Desktop image position",
      "options": [
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "top center",
          "label": "Top"
        },
        {
          "value": "bottom center",
          "label": "Bottom"
        },
        {
          "value": "left center",
          "label": "Left"
        },
        {
          "value": "right center",
          "label": "Right"
        }
      ],
      "default": "center center"
    },
    {
      "type": "select",
      "id": "mobile_image_position",
      "label": "Mobile image position",
      "options": [
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "top center",
          "label": "Top"
        },
        {
          "value": "bottom center",
          "label": "Bottom"
        },
        {
          "value": "left center",
          "label": "Left"
        },
        {
          "value": "right center",
          "label": "Right"
        }
      ],
      "default": "center center"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FEFBF9"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#290217"
    },
    {
      "type": "color",
      "id": "form_background_color",
      "label": "Form background color",
      "default": "#FAF3F4"
    },
    {
      "type": "color",
      "id": "radio_color",
      "label": "Radio button color",
      "default": "#290217"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background color",
      "default": "#AD686F"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "radio_option",
      "name": "Radio Option",
      "settings": [
        {
          "type": "text",
          "id": "option_label",
          "label": "Option label",
          "default": "Wrinkles/Fine Lines"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Newsletter with Image",
      "blocks": [
        {
          "type": "radio_option",
          "settings": {
            "option_label": "Wrinkles/Fine Lines"
          }
        },
        {
          "type": "radio_option",
          "settings": {
            "option_label": "Texture"
          }
        },
        {
          "type": "radio_option",
          "settings": {
            "option_label": "Redness"
          }
        },
        {
          "type": "radio_option",
          "settings": {
            "option_label": "Uneven Skin Tone"
          }
        },
        {
          "type": "radio_option",
          "settings": {
            "option_label": "Acne"
          }
        }
      ]
    }
  ]
}
{% endschema %}
