{% assign mega_nav = linklists[section.settings.menu] %}

<style>
/* ------------------------------
   DESKTOP: MIN WIDTH 1024PX
------------------------------- */
@media (min-width: 1024px) {

  .mega-menu {
    display: block;
    position: relative;
    width: 100%;
    padding-left: 0px;
  }

  .mega-menu > ul {
    display: flex;
    gap: 25px;
    list-style: none;
    padding: 0;
    margin: 0 auto;
    max-width: 1400px;
  }

  /* Top-level links */
  .mega-menu__item > a {
    padding: 12px 10px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    color: {{ section.settings.menu_text_color }};
    transition: color 0.18s ease, background 0.18s ease;
    border-radius: 4px;
  }

  /* Hover effect */
  .mega-menu__item:hover > a {
    background: {{ section.settings.hover_bg_color }};
    color: {{ section.settings.hover_text_color }};
  }

  /* Arrow if child exists */
  .mega-menu__item.has-children > a::after {
    content: "➤";
    font-size: 12px;
    margin-left: 6px;
    transition: transform 0.25s ease;
  }

  .mega-menu__item.has-children:hover > a::after {
    transform: rotate(90deg);
  }

  /* Dropdown panel */
  .mega-menu__dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    display: none;
    background: {{ section.settings.dropdown_bg }};
    padding: 35px 40px;
    box-shadow: 0 8px 24px rgba(0,0,0,.12);
    z-index: 100;
    min-height: 480px;
  }

  .mega-menu__columns {
    display: flex;
    gap: 50px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .mega-menu__level2 {
    width: 260px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .mega-menu__child > a {
    display: block;
    padding: 8px 0;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    color: {{ section.settings.submenu_text_color }};
  }

  .mega-menu__child:hover > a {
    font-weight: 600;
    color: {{ section.settings.submenu_hover_color }};
  }

  .mega-menu__products {
    flex: 1;
    min-width: 550px;
    max-height: 520px;
    overflow-y: auto;
  }

  .mega-menu__collection-products {
    display: none;
  }

  .mega-menu__grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 16px;
  }

  .mega-menu__product {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .mega-menu__thumb img {
    width: 100%;
    height: auto;
    border-radius: 6px;
  }

  .mega-menu__title {
    display: block;
    margin-top: 4px;
    font-size: 14px;
  }

  .mega-menu__more {
    margin-top: 12px;
    display: inline-block;
    font-size: 13px;
    font-weight: 600;
    color: {{ section.settings.view_more_color }};
  }
}

/* ------------------------------
   MOBILE: HIDE BELOW 1024PX
------------------------------- */
@media (max-width: 1023px) {
  .mega-menu {
    display: none;
  }
}
</style>

<nav class="mega-menu">
  <ul>
    {% for link in mega_nav.links %}
      {% if link.links.size > 0 %}
        {% assign item_classes = 'mega-menu__item has-children' %}
      {% else %}
        {% assign item_classes = 'mega-menu__item' %}
      {% endif %}

      <li class="{{ item_classes }}" data-mega="mega-{{ forloop.index }}">
        <a href="{{ link.url }}">{{ link.title }}</a>

        {% if link.links.size > 0 %}
        <div class="mega-menu__dropdown" id="mega-{{ forloop.index }}">
          <div class="mega-menu__columns">

            <ul class="mega-menu__level2">
              {% for child in link.links %}
              <li class="mega-menu__child" data-col="col-{{ forloop.index }}">
                <a href="{{ child.url }}">{{ child.title }}</a>
              </li>
              {% endfor %}
            </ul>

            <div class="mega-menu__products">
              {% for child in link.links %}
                {% assign collection_handle = child.url | split: '/collections/' | last %}
                {% assign col = collections[collection_handle] %}

                <div class="mega-menu__collection-products" id="col-{{ forloop.index }}">
                  {% if col %}
                    <h4>{{ col.title }}</h4>

                    <div class="mega-menu__grid">
                      {% for product in col.products limit: 18 %}
                      <a class="mega-menu__product" href="{{ product.url }}">
                        <div class="mega-menu__thumb">
                          {% if product.featured_image %}
                            <img src="{{ product.featured_image | img_url: '230x' }}" alt="{{ product.title }}">
                          {% endif %}
                        </div>
                        <span class="mega-menu__title">
                          {{ product.title | truncate: 28 }}
                        </span>
                      </a>
                      {% endfor %}
                    </div>

                    <a class="mega-menu__more" href="{{ col.url }}">
                      ➤ View more
                    </a>
                  {% else %}
                    <p>No products</p>
                  {% endif %}
                </div>
              {% endfor %}
            </div>

          </div>
        </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>

<script>
document.addEventListener("DOMContentLoaded", function () {

  if (window.innerWidth < 1024) return;

  document.querySelectorAll(".mega-menu__item").forEach(item => {
    const drop = document.getElementById(item.dataset.mega);

    item.addEventListener("mouseenter", () => {
      if (drop) drop.style.display = "block";
    });

    item.addEventListener("mouseleave", () => {
      if (drop) drop.style.display = "none";
    });
  });

  const groups = document.querySelectorAll(".mega-menu__collection-products");

  document.querySelectorAll(".mega-menu__child").forEach(child => {
    child.addEventListener("mouseenter", () => {
      groups.forEach(el => el.style.display = "none");
      const show = document.getElementById(child.dataset.col);
      if (show) show.style.display = "block";
    });
  });

  if (groups.length > 0) {
    groups[0].style.display = "block";
  }

});
</script>

{% schema %}
{
  "name": "Mega Menu",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Select Menu"
    },
    {
      "type": "color",
      "id": "menu_text_color",
      "label": "Menu Text Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "hover_bg_color",
      "label": "Top Hover Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "hover_text_color",
      "label": "Top Hover Text Color",
      "default": "#458CBD"
    },
    {
      "type": "color",
      "id": "dropdown_bg",
      "label": "Dropdown Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "submenu_text_color",
      "label": "Submenu Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "submenu_hover_color",
      "label": "Submenu Hover Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "view_more_color",
      "label": "View More Link Color",
      "default": "#000000"
    }
  ],
  "presets": [
    {
      "name": "Mega Menu"
    }
  ]
}
{% endschema %}
