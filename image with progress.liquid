<style>
  .skincare-transform {
    padding: 60px 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .skincare-transform__header {
    text-align: center;
    margin-bottom: 50px;
  }

  .skincare-transform__tagline {
    font-size: 16px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 15px;
    color: #232323;
  }

  .skincare-transform__title {
    font-size: 42px;
    font-weight: 300;
    margin: 0;
    color: #000;
  }

  .skincare-transform__content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
  }

  .skincare-transform__image-wrapper {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  }

  .skincare-transform__image {
    width: 100%;
    height: auto;
    display: block;
  }

.skincare-transform__caption {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;

  background: rgba(255, 255, 255, 0.6); /* glass base */
  backdrop-filter: blur(34px);
  -webkit-backdrop-filter: blur(34px); /* Safari support */

  padding: 30px 25px;
  color: #232323;
}


  .skincare-transform__caption-label {
    font-size: 14px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 8px;
    opacity: 0.9;
  }

  .skincare-transform__caption-title {
    font-size: 24px;
    font-weight: 400;
    margin: 0 0 8px 0;
  }

  .skincare-transform__caption-quote {
    font-size: 18px;
    font-style: italic;
    margin: 0;
    opacity: 0.95;
  }

  .skincare-transform__stats {
    display: flex;
    flex-direction: column;
    gap: 30px;
  }

  .skincare-transform__stat {
    display: flex;
    align-items: center;
    gap: 25px;
  }

  /* Progress Circle Styles */
  .skincare-transform__stat-progress {
    position: relative;
    min-width: 90px;
    height: 90px;
    flex-shrink: 0;
  }

  .skincare-transform__progress-circle {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
  }

  .skincare-transform__progress-bg {
    fill: none;
    stroke: #f0f0f0;
    stroke-width: 2;
  }

  .skincare-transform__progress-fill {
    fill: none;
    stroke: #D59DAA; /* Pink color */
    stroke-width: 2;
    stroke-linecap: round;
    stroke-dasharray: 283; /* Circumference of circle with radius 45 */
    stroke-dashoffset: 283;
    transition: stroke-dashoffset 2s ease-out;
  }

  .skincare-transform__stat-number {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    font-weight: 600;
    color: #000;
  }

  .skincare-transform__stat-count {
    display: inline-block;
  }

  .skincare-transform__stat-text {
    font-size: 20px;
    line-height: 1.5;
    color: #232323;
  }

  .skincare-transform__footer {
    margin-top: 30px;
    padding-top: 30px;
    border-top: 1px solid #e0e0e0;
  }

  .skincare-transform__study-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #232323;
  }

  .skincare-transform__study-description {
    font-size: 18px;
    line-height: 1.6;
    color: #666;
    margin: 0;
  }

  /* Responsive Design */
  @media (max-width: 968px) {
    .skincare-transform {
      padding: 50px 20px;
    }

    .skincare-transform__title {
      font-size: 36px;
    }

    .skincare-transform__content {
      gap: 40px;
    }

    .skincare-transform__stat-progress {
      min-width: 80px;
      height: 80px;
    }

    .skincare-transform__stat-number {
      font-size: 24px;
    }

    .skincare-transform__stat-text {
      font-size: 15px;
    }
  }

  @media (max-width: 768px) {
    .skincare-transform {
      padding: 40px 16px;
    }

    .skincare-transform__title {
      font-size: 28px;
    }

    .skincare-transform__content {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .skincare-transform__caption {
      padding: 20px;
    }

    .skincare-transform__caption-title {
      font-size: 20px;
    }

    .skincare-transform__caption-quote {
      font-size: 13px;
    }

    .skincare-transform__stat {
      gap: 20px;
    }

    .skincare-transform__stat-progress {
      min-width: 70px;
      height: 70px;
    }

    .skincare-transform__stat-number {
      font-size: 22px;
    }

    .skincare-transform__stat-text {
      font-size: 14px;
    }
  }

  @media (max-width: 480px) {
    .skincare-transform {
      padding: 30px 16px;
    }

    .skincare-transform__tagline {
      font-size: 12px;
    }

    .skincare-transform__title {
      font-size: 24px;
    }

    .skincare-transform__caption {
      padding: 16px;
    }

    .skincare-transform__caption-label {
      font-size: 12px;
    }

    .skincare-transform__caption-title {
      font-size: 22px;
    }

    .skincare-transform__stat-progress {
      min-width: 65px;
      height: 65px;
    }

    .skincare-transform__stat-number {
      font-size: 20px;
    }
  }
</style>

<div class="skincare-transform">
  {% if section.settings.tagline != blank %}
    <div class="skincare-transform__header">
      <p class="skincare-transform__tagline">{{ section.settings.tagline }}</p>
      <h2 class="skincare-transform__title">{{ section.settings.title }}</h2>
    </div>
  {% endif %}

  <div class="skincare-transform__content">
    <!-- Before/After Image Section -->
    <div class="skincare-transform__image-wrapper">
      {% if section.settings.image != blank %}
        <img 
          src="{{ section.settings.image | img_url: '800x' }}" 
          alt="{{ section.settings.image_alt }}"
          class="skincare-transform__image"
          loading="lazy"
        >
      {% else %}
        {{ 'image' | placeholder_svg_tag: 'skincare-transform__image' }}
      {% endif %}
      
      <div class="skincare-transform__caption">
        <p class="skincare-transform__caption-label">{{ section.settings.caption_label }}</p>
        <h3 class="skincare-transform__caption-title">{{ section.settings.caption_title }}</h3>
        <p class="skincare-transform__caption-quote">"{{ section.settings.caption_quote }}"</p>
      </div>
    </div>

    <!-- Statistics Section with Progress Circles -->
    <div class="skincare-transform__stats">
      {% for block in section.blocks %}
        {% if block.type == 'stat' %}
          {% assign percentage_value = block.settings.percentage | remove: '%' | plus: 0 %}
          {% assign dashoffset = 283 | times: 1.0 | minus: 283 | times: percentage_value | divided_by: 100 %}
          
          <div class="skincare-transform__stat" {{ block.shopify_attributes }}>
            <div class="skincare-transform__stat-progress">
              <svg class="skincare-transform__progress-circle" viewBox="0 0 100 100">
                <circle class="skincare-transform__progress-bg" cx="50" cy="50" r="45"></circle>
                <circle 
                  class="skincare-transform__progress-fill" 
                  cx="50" 
                  cy="50" 
                  r="45"
                  data-percentage="{{ percentage_value }}"
                  style="stroke-dashoffset: 283;"
                ></circle>
              </svg>
              <div class="skincare-transform__stat-number">
                <span class="skincare-transform__stat-count">0%</span>
              </div>
            </div>
            <p class="skincare-transform__stat-text">{{ block.settings.description }}</p>
          </div>
        {% endif %}
      {% endfor %}
        <!-- Study Footer -->
  {% if section.settings.show_study_info %}
    <div class="skincare-transform__footer">
      <h4 class="skincare-transform__study-title">{{ section.settings.study_title }}</h4>
      <p class="skincare-transform__study-description">{{ section.settings.study_description }}</p>
    </div>
  {% endif %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const progressCircles = document.querySelectorAll('.skincare-transform__progress-fill');
  const statCounts = document.querySelectorAll('.skincare-transform__stat-count');
  
  // Animation function
  function animateProgress() {
    progressCircles.forEach((circle, index) => {
      const rect = circle.getBoundingClientRect();
      const isVisible = rect.top < window.innerHeight && rect.bottom >= 0;
      
      if (isVisible && !circle.classList.contains('animated')) {
        circle.classList.add('animated');
        
        const percentage = parseInt(circle.getAttribute('data-percentage'));
        const circumference = 283; // 2 * π * 45
        const dashoffset = circumference - (circumference * percentage / 100);
        
        // Animate the circle
        circle.style.strokeDashoffset = dashoffset;
        
        // Animate the number count
        const statCount = statCounts[index];
        let start = 0;
        const end = percentage;
        const duration = 2000; // 2 seconds
        const increment = end / (duration / 16); // 60fps
        
        function updateCount() {
          start += increment;
          if (start < end) {
            statCount.textContent = Math.round(start) + '%';
            requestAnimationFrame(updateCount);
          } else {
            statCount.textContent = end + '%';
          }
        }
        
        updateCount();
      }
    });
  }
  
  // Initial check
  animateProgress();
  
  // Check on scroll
  window.addEventListener('scroll', animateProgress);
  
  // Optional: Use Intersection Observer for better performance
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const circle = entry.target;
          const index = Array.from(progressCircles).indexOf(circle);
          
          if (!circle.classList.contains('animated')) {
            circle.classList.add('animated');
            
            const percentage = parseInt(circle.getAttribute('data-percentage'));
            const circumference = 283;
            const dashoffset = circumference - (circumference * percentage / 100);
            
            // Animate the circle
            circle.style.strokeDashoffset = dashoffset;
            
            // Animate the number count
            const statCount = statCounts[index];
            let start = 0;
            const end = percentage;
            const duration = 2000;
            const increment = end / (duration / 16);
            
            function updateCount() {
              start += increment;
              if (start < end) {
                statCount.textContent = Math.round(start) + '%';
                requestAnimationFrame(updateCount);
              } else {
                statCount.textContent = end + '%';
              }
            }
            
            updateCount();
          }
        }
      });
    }, { threshold: 0.5 });
    
    progressCircles.forEach(circle => observer.observe(circle));
  }
});
</script>

{% schema %}
{
  "name": "Skincare Transformation",
  "settings": [
    {
      "type": "text",
      "id": "tagline",
      "label": "Tagline",
      "default": "NOT MAGIC. JUST SCIENCE."
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Transform your skin in 8 weeks"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Before/After Image"
    },
    {
      "type": "text",
      "id": "image_alt",
      "label": "Image Alt Text",
      "default": "Skincare transformation results"
    },
    {
      "type": "text",
      "id": "caption_label",
      "label": "Caption Label",
      "default": "VISIBLE IMPROVEMENT"
    },
    {
      "type": "text",
      "id": "caption_title",
      "label": "Caption Title",
      "default": "Radiant, Smoother Skin"
    },
    {
      "type": "text",
      "id": "caption_quote",
      "label": "Caption Quote",
      "default": "My skin is glowing and my frown lines looks softer"
    },
    {
      "type": "checkbox",
      "id": "show_study_info",
      "label": "Show Study Information",
      "default": true
    },
    {
      "type": "text",
      "id": "study_title",
      "label": "Study Title",
      "default": "Clinical & Consumer Perception Study"
    },
    {
      "type": "textarea",
      "id": "study_description",
      "label": "Study Description",
      "default": "†Based on a 30-day consumer study with 60 participants using the 4-in-1 Skincare Wand, 5x a week."
    }
  ],
  "blocks": [
    {
      "type": "stat",
      "name": "Statistic",
      "settings": [
        {
          "type": "text",
          "id": "percentage",
          "label": "Percentage",
          "default": "97%"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "said their skin looks more radiant and glowing"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Skincare Transformation",
      "blocks": [
        {
          "type": "stat",
          "settings": {
            "percentage": "97%",
            "description": "said their skin looks more radiant and glowing"
          }
        },
        {
          "type": "stat",
          "settings": {
            "percentage": "91%",
            "description": "said their skin appears younger"
          }
        },
        {
          "type": "stat",
          "settings": {
            "percentage": "88%",
            "description": "said they saw a visible reduction in fine lines and wrinkles"
          }
        }
      ]
    }
  ]
}
{% endschema %}
