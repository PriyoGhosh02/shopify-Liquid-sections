{% assign sid = section.id %}
{% assign half_circle = section.settings.circle_size | divided_by: 2 %}


<section id="hiw-{{ sid }}" class="hiw-section">
  <div class="hiw-container">


    <div class="hiw-header">
      <div class="hiw-eyebrow">{{ section.settings.eyebrow }}</div>
      <h2 class="hiw-title">
        {{ section.settings.title }}
        <span>{{ section.settings.highlight }}</span>
      </h2>
    </div>


    <div class="hiw-steps-wrapper">
      <div class="hiw-steps">
        {% for block in section.blocks %}
        <div class="hiw-step" {{ block.shopify_attributes }}>
          <div class="hiw-circle">
            {{ block.settings.number }}
          </div>
          <h3>{{ block.settings.heading }}</h3>
          <p>{{ block.settings.text }}</p>
        </div>
        {% endfor %}
      </div>
    </div>


  </div>
</section>


<style>
#hiw-{{ sid }} {
  background: {{ section.settings.bg_color }};
  padding: {{ section.settings.padding_top }}px 20px {{ section.settings.padding_bottom }}px;
  text-align: center;
}


#hiw-{{ sid }} .hiw-container {
  max-width: {{ section.settings.max_width }}px;
  margin: auto;
  padding: 0 15px;
}


#hiw-{{ sid }} .hiw-eyebrow {
  color: {{ section.settings.eyebrow_color }};
  font-size: {{ section.settings.eyebrow_size }}px;
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 15px;
}


#hiw-{{ sid }} .hiw-title {
  font-size: {{ section.settings.title_size }}px;
  color: {{ section.settings.title_color }};
  font-weight: 600;
  margin-bottom: 50px;
}


#hiw-{{ sid }} .hiw-title span {
  color: {{ section.settings.highlight_color }};
}


#hiw-{{ sid }} .hiw-steps-wrapper {
  position: relative;
}


#hiw-{{ sid }} .hiw-steps {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  position: relative;
  --line-scale: 0; /* scroll-controlled */
}


#hiw-{{ sid }} .hiw-steps::before {
  content: '';
  position: absolute;
  top: {{ half_circle }}px;
  height: 2px;
  background: {{ section.settings.line_color }};
  z-index: 0;
  transform: scaleX(var(--line-scale, 0));
  transform-origin: left center;
  left: var(--line-left, 0px);
  width: var(--line-width, 100%);
}


#hiw-{{ sid }} .hiw-step {
  width: 25%;
  position: relative;
  z-index: 1;
}


#hiw-{{ sid }} .hiw-circle {
  width: {{ section.settings.circle_size }}px;
  height: {{ section.settings.circle_size }}px;
  border-radius: 50%;
  margin: 0 auto 20px;
  border: 2px solid {{ section.settings.circle_border }};
  color: {{ section.settings.circle_text }};
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: {{ section.settings.circle_font_size }}px;
  background: {{ section.settings.bg_color }};
  position: relative;
  z-index: 2;
}


#hiw-{{ sid }} .hiw-step h3 {
  color: {{ section.settings.heading_color }};
  font-size: {{ section.settings.heading_size }}px;
  margin-bottom: 10px;
}


#hiw-{{ sid }} .hiw-step p {
  color: {{ section.settings.text_color }};
  font-size: {{ section.settings.text_size }}px;
  max-width: 220px;
  margin: 0 auto;
}


/* MOBILE */
@media (max-width: 768px) {
  #hiw-{{ sid }} .hiw-steps {
    flex-direction: column;
    gap: 30px;
    align-items: center;
  }


  #hiw-{{ sid }} .hiw-steps::before {
    display: none;
  }


  #hiw-{{ sid }} .hiw-step {
    width: 100%;
    text-align: center;
  }


  #hiw-{{ sid }} .hiw-step p {
    max-width: 90%;
  }


  #hiw-{{ sid }} .hiw-title {
    font-size: calc({{ section.settings.title_size }}px * 0.7);
  }


  #hiw-{{ sid }} .hiw-eyebrow {
    font-size: calc({{ section.settings.eyebrow_size }}px * 0.8);
  }


  #hiw-{{ sid }} .hiw-circle {
    width: calc({{ section.settings.circle_size }}px * 0.8);
    height: calc({{ section.settings.circle_size }}px * 0.8);
    font-size: calc({{ section.settings.circle_font_size }}px * 0.8);
  }


  #hiw-{{ sid }} .hiw-step h3 {
    font-size: calc({{ section.settings.heading_size }}px * 0.9);
  }


  #hiw-{{ sid }} .hiw-step p {
    font-size: calc({{ section.settings.text_size }}px * 0.9);
  }
}
</style>


<script>
(function() {
  const section = document.getElementById('hiw-{{ sid }}');
  if (!section) return;


  const steps = section.querySelector('.hiw-steps');
  const circles = section.querySelectorAll('.hiw-circle');


  function setLinePosition() {
    if (circles.length < 2) return;


    const first = circles[0].getBoundingClientRect();
    const last = circles[circles.length - 1].getBoundingClientRect();
    const parent = steps.getBoundingClientRect();


    const left = first.left + first.width / 2 - parent.left;
    const width = (last.left + last.width / 2) - (first.left + first.width / 2);


    steps.style.setProperty('--line-left', left + 'px');
    steps.style.setProperty('--line-width', width + 'px');
  }


  function updateLine() {
    const rect = section.getBoundingClientRect();
    const start = window.innerHeight * 0.1; // start when top is 10% from viewport
    const end = rect.height + window.innerHeight * 0.7; // finish at bottom + 90% vh


    let progress = (window.innerHeight - rect.top - start) / (end - start);
    progress = Math.max(0, Math.min(1, progress));


    steps.style.setProperty('--line-scale', progress);
  }


  function init() {
    setLinePosition();
    updateLine();
  }


  window.addEventListener('scroll', updateLine, { passive: true });
  window.addEventListener('resize', init);


  init();
})();
</script>


{% schema %}
{
  "name": "Progress pointer",
  "settings": [
    { "type":"text","id":"eyebrow","label":"Eyebrow","default":"Simple Process"},
    { "type":"text","id":"title","label":"Title","default":"How Your Purchase"},
    { "type":"text","id":"highlight","label":"Highlight Word","default":"Helps"},
    { "type":"color","id":"bg_color","label":"Background","default":"#1f3560"},
    { "type":"color","id":"title_color","label":"Title Color","default":"#ffffff"},
    { "type":"color","id":"highlight_color","label":"Highlight Color","default":"#63b3e4"},
    { "type":"color","id":"eyebrow_color","label":"Eyebrow Color","default":"#63b3e4"},
    { "type":"color","id":"line_color","label":"Line Color","default":"#63b3e4"},
    { "type":"color","id":"circle_border","label":"Circle Border","default":"#63b3e4"},
    { "type":"color","id":"circle_text","label":"Circle Number Color","default":"#63b3e4"},
    { "type":"color","id":"circle_bg","label":"Circle Background","default":"transparent"},
    { "type":"color","id":"heading_color","label":"Heading Color","default":"#ffffff"},
    { "type":"color","id":"text_color","label":"Text Color","default":"#a9c3de"},
    { "type":"range","id":"max_width","min":900,"max":1600,"step":50,"default":1200,"label":"Max Width"},
    { "type":"range","id":"padding_top","min":0,"max":200,"step":10,"default":80,"label":"Padding Top"},
    { "type":"range","id":"padding_bottom","min":0,"max":200,"step":10,"default":80,"label":"Padding Bottom"},
    { "type":"range","id":"title_size","min":24,"max":80,"step":2,"default":48,"label":"Title Size"},
    { "type":"range","id":"eyebrow_size","min":10,"max":20,"step":1,"default":12,"label":"Eyebrow Size"},
    { "type":"range","id":"circle_size","min":50,"max":120,"step":2,"default":70,"label":"Circle Size"},
    { "type":"range","id":"circle_font_size","min":14,"max":40,"step":1,"default":20,"label":"Circle Number Size"},
    { "type":"range","id":"heading_size","min":14,"max":30,"step":1,"default":18,"label":"Heading Size"},
    { "type":"range","id":"text_size","min":12,"max":22,"step":1,"default":15,"label":"Text Size"}
  ],
  "blocks":[
    {
      "type":"step",
      "name":"Step",
      "settings":[
        {"type":"text","id":"number","label":"Step Number","default":"01"},
        {"type":"text","id":"heading","label":"Heading","default":"Browse"},
        {"type":"textarea","id":"text","label":"Description","default":"Explore our collection of quality merchandise."}
      ]
    }
  ],
  "max_blocks":4,
  "presets":[
    {
      "name":"Progress pointer",
      "blocks":[
        {"type":"step"},
        {"type":"step"},
        {"type":"step"},
        {"type":"step"}
      ]
    }
  ]
}
{% endschema %}



